---
import '../styles/global.css';
import MobileNav from '../components/MobileNav.astro';
import SearchBox from '../components/SearchBox.astro';
import FooterContactForm from '../components/FooterContactForm.astro';
import FloatingCallButton from '../components/FloatingCallButton.astro';
import LiveChatWidget from '../components/LiveChatWidget.astro';

export interface Props {
  title: string;
  description?: string;
  service?: 'plumbing' | 'electrical';
  showBookingCTA?: boolean;
  canonicalURL?: string;
  ogImage?: string;
}

const {
  title,
  description = 'DSpots Emergency Plumbing & Electrical Services - 24/7 professional services in Vancouver. Call (672) 238-4660 for immediate help!',
  service,
  showBookingCTA = true,
  canonicalURL = `https://dspots.com${Astro.url.pathname}`,
  ogImage = 'https://dspots.com/images/heroes/Hero.png'
} = Astro.props;
---

<!doctype html>
<html lang="en" class="h-full scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

    <!-- Performance & SEO -->
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph Meta Tags for Facebook/Social Media -->
    <meta property="og:title" content={`${title} | DSpots Emergency Services`} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="DSpots Emergency Services - 24/7 Plumbing and Electrical Services in Vancouver" />
    <meta property="og:site_name" content="DSpots Emergency Services" />
    <meta property="og:locale" content="en_CA" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${title} | DSpots Emergency Services`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <meta name="twitter:image:alt" content="DSpots Emergency Services - 24/7 Plumbing and Electrical Services in Vancouver" />
    <meta name="twitter:site" content="@dspots" />

    <!-- Additional SEO Meta Tags -->
    <meta name="author" content="DSpots Emergency Services" />
    <meta name="publisher" content="DSpots Emergency Services" />
    <meta name="keywords" content="emergency plumber vancouver, 24/7 electrician vancouver, emergency plumbing, electrical repairs vancouver, burst pipe repair, power outage help" />

    <!-- Icons & Manifest -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#1e40af" />

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">

    <!-- Preload Critical Assets -->
    <link rel="preload" href="/images/branding/logo.png" as="image" type="image/png">
    <link rel="preload" href="/favicon.png" as="image" type="image/png">

    <!-- Critical CSS Fonts with Display Swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Emergency Phone Number Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "DSpots Emergency Plumbing & Electrical Services",
        "description": "24/7 emergency plumbing and electrical services in Vancouver",
        "telephone": "+1-672-238-4660",
        "url": "https://dspots.com",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Vancouver",
          "addressRegion": "BC",
          "addressCountry": "CA"
        },
        "openingHours": "Mo-Su 00:00-23:59",
        "serviceArea": {
          "@type": "Place",
          "name": "Vancouver & Lower Mainland"
        },
        "priceRange": "$",
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Emergency Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Emergency Plumbing",
                "description": "24/7 plumbing repairs and maintenance"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Emergency Electrical",
                "description": "24/7 electrical repairs and installations"
              }
            }
          ]
        }
      }
    </script>

    <!-- Service-specific Schema -->
    {service === 'plumbing' && (
      <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "ProfessionalService",
          "name": "DSpots Emergency Plumbing Services",
          "serviceType": "Plumbing",
          "provider": {
            "@type": "LocalBusiness",
            "name": "DSpots Emergency Services",
            "telephone": "+1-672-238-4660",
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Vancouver",
              "addressRegion": "BC",
              "addressCountry": "CA"
            }
          },
          "areaServed": "Vancouver, BC",
          "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Plumbing Services",
            "itemListElement": [
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "24 Hour Plumber Vancouver - Emergency Repairs",
                  "description": "24 hour plumber Vancouver for burst pipe repair Vancouver and emergency plumbing services"
                }
              },
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "Drain Cleaning Vancouver & Rooter Service",
                  "description": "Drain cleaning Vancouver and rooter service Vancouver for clogged drain repair"
                }
              },
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "Hot Water Tank Repair Vancouver",
                  "description": "Hot water tank repair Vancouver and water heater installation Vancouver services"
                }
              }
            ]
          }
        }
      </script>
    )}

    {service === 'electrical' && (
      <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "ProfessionalService",
          "serviceType": "Electrical",
          "name": "DSpots Emergency Electrical Services",
          "provider": {
            "@type": "LocalBusiness",
            "name": "DSpots Emergency Services",
            "telephone": "+1-672-238-4660",
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Vancouver",
              "addressRegion": "BC",
              "addressCountry": "CA"
            }
          },
          "areaServed": "Vancouver, BC",
          "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Electrical Services",
            "itemListElement": [
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "24 Hour Electrician Vancouver - Emergency Repairs",
                  "description": "24 hour electrician Vancouver for power outage electrician and urgent electrical repair Vancouver"
                }
              },
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "Panel Upgrade Vancouver & Electrical Panel Installation",
                  "description": "Panel upgrade Vancouver and electrical panel installation Vancouver services"
                }
              },
              {
                "@type": "Offer",
                "itemOffered": {
                  "@type": "Service",
                  "name": "Home Electrical Repair Vancouver & Wiring",
                  "description": "Home electrical repair Vancouver and whole house rewiring Vancouver services"
                }
              }
            ]
          }
        }
      </script>
    )}

    <title>{title} | DSpots Emergency Services</title>
  </head>
  <body class="h-full bg-stone-50 font-sans antialiased" style="font-family: 'Inter', system-ui, sans-serif;">
    <!-- Sticky Emergency CTA for Mobile -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-red-600 text-white z-40 px-4 py-2">
      <a href="tel:6722384660" class="flex items-center justify-center gap-2 text-sm font-semibold touch-manipulation">
        <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
        <span>EMERGENCY: (672) 238-4660</span>
      </a>
    </div>

    <header class="bg-white/95 backdrop-blur-md sticky top-0 z-50 border-b border-stone-200/50 mt-10 md:mt-0">
      <nav class="max-w-6xl mx-auto px-4 md:px-6 lg:px-12">
        <div class="flex justify-between items-center h-16 md:h-20">
          <!-- Logo/Brand -->
          <div class="flex items-center">
            <a href="/" class="flex items-center gap-3 touch-manipulation">
              <img
                src="/images/branding/logo.png"
                alt="DSpots Emergency Plumbing & Electrical Services - Professional contracting company logo"
                class="h-8 sm:h-10 md:h-12 lg:h-14 w-auto max-w-none"
                loading="eager"
                width="200"
                height="60"
              />
            </a>
          </div>

          <!-- Desktop Navigation -->
          <div class="hidden lg:flex items-center space-x-1">
            <!-- Emergency Services - Priority Position -->
            <a href="/emergency" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2.5 rounded-full text-sm font-bold transition-all duration-200 touch-manipulation shadow-sm hover:shadow-md">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
                <span>Get Emergency Help</span>
              </div>
            </a>

            <!-- Main Services -->
            <a href="/plumbing" class={`px-4 py-2.5 rounded-full text-sm font-medium transition-all duration-200 touch-manipulation ${service === 'plumbing' ? 'bg-blue-100 text-blue-800 shadow-sm border border-blue-200' : 'text-slate-600 hover:text-blue-700 hover:bg-blue-50'}`}>
              Plumbing Services
            </a>
            <a href="/electrical" class={`px-4 py-2.5 rounded-full text-sm font-medium transition-all duration-200 touch-manipulation ${service === 'electrical' ? 'bg-orange-100 text-orange-800 shadow-sm border border-orange-200' : 'text-slate-600 hover:text-orange-600 hover:bg-orange-50'}`}>
              Electrical Services
            </a>

            <!-- Search Box -->
            <div class="ml-4">
              <SearchBox />
            </div>

            <!-- Contact CTA -->
            <a href="/contact" class="bg-slate-700 text-white hover:bg-slate-600 px-6 py-2.5 rounded-full text-sm font-medium transition-all duration-200 ml-4 shadow-sm touch-manipulation">
              Contact Us
            </a>
          </div>

          <!-- Simplified Desktop Navigation for Medium Screens -->
          <div class="hidden md:flex lg:hidden items-center space-x-1">
            <!-- Emergency Services - Always visible -->
            <a href="/emergency" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-full text-xs font-bold transition-all duration-200 touch-manipulation shadow-sm">
              <div class="flex items-center gap-1">
                <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                <span>Emergency</span>
              </div>
            </a>

            <!-- Services Dropdown -->
            <div class="relative group">
              <button class="text-stone-600 hover:text-stone-800 px-3 py-2 rounded-full text-sm font-medium transition-colors duration-200 touch-manipulation flex items-center gap-1">
                <span>Services</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>

              <!-- Dropdown Menu -->
              <div class="absolute top-full left-0 mt-1 w-48 bg-white border border-stone-200 rounded-xl shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="p-2">
                  <a href="/plumbing" class={`block px-3 py-2 rounded-lg text-sm transition-colors ${service === 'plumbing' ? 'bg-blue-50 text-blue-800' : 'text-slate-700 hover:bg-blue-50 hover:text-blue-700'}`}>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                      <span>Plumbing Services</span>
                    </div>
                  </a>
                  <a href="/electrical" class={`block px-3 py-2 rounded-lg text-sm transition-colors ${service === 'electrical' ? 'bg-orange-50 text-orange-800' : 'text-slate-700 hover:bg-orange-50 hover:text-orange-600'}`}>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                      <span>Electrical Services</span>
                    </div>
                  </a>
                </div>
              </div>
            </div>

            <!-- Contact -->
            <a href="/contact" class="bg-slate-700 text-white hover:bg-slate-600 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 shadow-sm touch-manipulation">
              Contact
            </a>
          </div>

          <!-- Mobile Navigation Component -->
          <MobileNav service={service} />
        </div>
      </nav>
    </header>

    <main class="flex-1">
      <slot />
    </main>

    <!-- Footer with Contact Form -->
    <FooterContactForm />

    <!-- Simple Copyright Footer -->
    <footer class="bg-white border-t border-stone-200 py-6">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-12">
        <div class="flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0 text-center md:text-left">
          <p class="text-xs text-stone-500">
            © 2024 DSpots Emergency Services. Licensed & Insured.
          </p>
          <div class="flex items-center justify-center space-x-3 md:space-x-6 text-xs text-stone-500">
            <span>Professional</span>
            <span>•</span>
            <span>Reliable</span>
            <span>•</span>
            <span>Available 24/7</span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Floating Call Button -->
    <FloatingCallButton />

    <!-- Live Chat Widget -->
    <LiveChatWidget />

  </body>
</html>