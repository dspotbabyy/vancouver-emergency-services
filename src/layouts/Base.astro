---
import '../styles/global.css';
import SEO from '../components/SEO.astro';
import MobileMenu from '../components/MobileMenu.astro';
import StickyCallBar from '../components/StickyCallBar.astro';
import SearchBox from '../components/SearchBox.astro';
import FooterContactForm from '../components/FooterContactForm.astro';
import FloatingCallButton from '../components/FloatingCallButton.astro';
import LiveChatWidget from '../components/LiveChatWidget.astro';
import CallLink from '../components/CallLink.astro';

export interface Props {
  title: string;
  description?: string;
  service?: 'plumbing' | 'electrical';
  showBookingCTA?: boolean;
  canonicalURL?: string;
  ogImage?: string;
  keywords?: string;
}

const {
  title,
  description = 'DSpots Emergency Services - 24/7 professional plumbing and electrical services in Vancouver, Burnaby, Richmond, Surrey, and North Vancouver. Call (672) 238-4660 for immediate help!',
  service,
  showBookingCTA = true,
  canonicalURL = `https://dspots.com${Astro.url.pathname}`,
  ogImage = 'https://dspots.com/images/heroes/Hero.png',
  keywords = 'emergency plumber vancouver, 24/7 electrician vancouver, emergency plumbing, electrical repairs vancouver, burst pipe repair, power outage help'
} = Astro.props;
---

<!doctype html>
<html lang="en" class="h-full scroll-smooth">
  <head>
    <meta charset="UTF-8" />

    <!-- SEO Component -->
    <SEO
      title={title}
      description={description}
      service={service}
      canonicalURL={canonicalURL}
      ogImage={ogImage}
      keywords={keywords}
    />

    <!-- Icons & Manifest -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#1e40af" />

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">

    <!-- Preload Critical Assets -->
    <link rel="preload" href="/images/branding/logo.png" as="image" type="image/png">
    <link rel="preload" href="/favicon.png" as="image" type="image/png">

    <!-- Critical CSS Fonts with Display Swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Focus-visible styles for better accessibility -->
    <style>
      .focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
      }

      /* Skip to content link */
      .skip-to-content {
        position: absolute;
        top: -40px;
        left: 6px;
        background: #000;
        color: #fff;
        padding: 8px;
        text-decoration: none;
        z-index: 100;
        border-radius: 4px;
      }

      .skip-to-content:focus {
        top: 6px;
      }
    </style>
  </head>
  <body class="h-full bg-stone-50 font-sans antialiased" style="font-family: 'Inter', system-ui, sans-serif;">

    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-to-content focus-visible">Skip to main content</a>

    <!-- Sticky Emergency CTA for Mobile -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-red-600 text-white z-40 px-4 py-2">
      <CallLink urgent={true} class="flex items-center justify-center gap-2 text-sm font-semibold touch-manipulation text-white hover:text-white" />
    </div>

    <header class="bg-white/95 backdrop-blur-md sticky top-0 z-50 border-b border-stone-200/50 mt-10 md:mt-0">
      <nav class="max-w-6xl mx-auto px-4 md:px-6 lg:px-12">
        <div class="flex justify-between items-center h-16 md:h-20">
          <!-- Logo/Brand -->
          <div class="flex items-center">
            <a href="/" class="flex items-center gap-3 touch-manipulation">
              <img
                src="/images/branding/logo.png"
                alt="DSpots Emergency Services - Professional plumbing and electrical contractor logo"
                class="h-8 sm:h-10 md:h-12 lg:h-14 w-auto max-w-none"
                loading="eager"
                decoding="async"
                width="200"
                height="60"
              />
            </a>
          </div>

          <!-- Desktop Navigation -->
          <div class="hidden lg:flex items-center space-x-1">
            <!-- Emergency Services - Priority Position -->
            <a href="/emergency" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2.5 rounded-full text-sm font-bold transition-all duration-200 touch-manipulation shadow-sm hover:shadow-md focus-visible">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
                <span>Get Emergency Help</span>
              </div>
            </a>

            <!-- Main Services -->
            <a href="/plumbing" class={`px-4 py-2.5 rounded-full text-sm font-medium transition-all duration-200 touch-manipulation focus-visible ${service === 'plumbing' ? 'bg-blue-100 text-blue-800 shadow-sm border border-blue-200' : 'text-slate-600 hover:text-blue-700 hover:bg-blue-50'}`}>
              Plumbing Services
            </a>
            <a href="/electrical" class={`px-4 py-2.5 rounded-full text-sm font-medium transition-all duration-200 touch-manipulation focus-visible ${service === 'electrical' ? 'bg-orange-100 text-orange-800 shadow-sm border border-orange-200' : 'text-slate-600 hover:text-orange-600 hover:bg-orange-50'}`}>
              Electrical Services
            </a>

            <!-- Search Box -->
            <div class="ml-4">
              <SearchBox />
            </div>

            <!-- Contact CTA -->
            <a href="/contact" class="bg-slate-700 text-white hover:bg-slate-600 px-6 py-2.5 rounded-full text-sm font-medium transition-all duration-200 ml-4 shadow-sm touch-manipulation focus-visible">
              Contact Us
            </a>
          </div>

          <!-- Simplified Desktop Navigation for Medium Screens -->
          <div class="hidden md:flex lg:hidden items-center space-x-1">
            <!-- Emergency Services - Always visible -->
            <a href="/emergency" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-full text-xs font-bold transition-all duration-200 touch-manipulation shadow-sm focus-visible">
              <div class="flex items-center gap-1">
                <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                <span>Emergency</span>
              </div>
            </a>

            <!-- Services Dropdown -->
            <div class="relative group">
              <button class="text-stone-600 hover:text-stone-800 px-3 py-2 rounded-full text-sm font-medium transition-colors duration-200 touch-manipulation flex items-center gap-1 focus-visible">
                <span>Services</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>

              <!-- Dropdown Menu -->
              <div class="absolute top-full left-0 mt-1 w-48 bg-white border border-stone-200 rounded-xl shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="p-2">
                  <a href="/plumbing" class={`block px-3 py-2 rounded-lg text-sm transition-colors focus-visible ${service === 'plumbing' ? 'bg-blue-50 text-blue-800' : 'text-slate-700 hover:bg-blue-50 hover:text-blue-700'}`}>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                      <span>Plumbing Services</span>
                    </div>
                  </a>
                  <a href="/electrical" class={`block px-3 py-2 rounded-lg text-sm transition-colors focus-visible ${service === 'electrical' ? 'bg-orange-50 text-orange-800' : 'text-slate-700 hover:bg-orange-50 hover:text-orange-600'}`}>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                      <span>Electrical Services</span>
                    </div>
                  </a>
                </div>
              </div>
            </div>

            <!-- Contact -->
            <a href="/contact" class="bg-slate-700 text-white hover:bg-slate-600 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 shadow-sm touch-manipulation focus-visible">
              Contact
            </a>
          </div>

          <!-- Mobile Navigation Component -->
          <MobileMenu service={service} />
        </div>
      </nav>
    </header>

    <main id="main-content" class="flex-1">
      <slot />
    </main>

    <!-- Footer with Contact Form -->
    <FooterContactForm />

    <!-- Simple Copyright Footer -->
    <footer class="bg-white border-t border-stone-200 py-6">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-12">
        <div class="flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0 text-center md:text-left">
          <p class="text-xs text-stone-500">
            © 2024 DSpots Emergency Services. Licensed & Insured.
          </p>
          <div class="flex items-center justify-center space-x-3 md:space-x-6 text-xs text-stone-500">
            <span>Professional</span>
            <span>•</span>
            <span>Reliable</span>
            <span>•</span>
            <span>Available 24/7</span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Floating Call Button -->
    <FloatingCallButton />

    <!-- Live Chat Widget -->
    <LiveChatWidget />

    <!-- Sticky Call Bar (Mobile Only) -->
    <StickyCallBar />

  </body>
</html>